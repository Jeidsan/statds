--- 
title: "Estatística e Ciência de Dados"
subtitle: "Notas e solução dos exercícios"
author: "Jeidsan A. da C. Pereira"
date: "22 de janeiro de 2024"
site: bookdown::bookdown_site
documentclass: "latex/krantz"
bibliography: 
  - latex/book.bib
  - latex/packages.bib
csl: "latex/abnt.csl"
url: "https://www.jeidsan.com.br/statds"
cover-image: "images/cover.png"
description: |
  Esta página contém notas e solução para os exercícios propostos no livro **Estatística e Ciência de Dados**, de autoria de Pedro Alberto Morettin e Júlio da Motta Singer, publicado pela LTC em 2022.
link-citations: yes
---

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(e1071)
library(gridExtra)

data_dir <- paste0(getwd(), "/data/")

options(
  repr.plot.width = 24, 
  repr.plot.height = 13,
  knitr.kable.NA = " - "
)

tema <- theme_bw() +
          theme(
            plot.title   = element_text(size = 12, vjust = +2, hjust = 0.5),
            axis.title.y = element_text(size = 10, vjust = +4),
            axis.title.x = element_text(size = 10, vjust = -1),
            axis.text.y  = element_text(size = 10),
            axis.text.x  = element_text(size = 10),
            legend.text  = element_text(size = 10),
            strip.text   = element_text(size = 10)
          )
```

# Prefácio {-}

Esta página contém notas e solução para os exercícios propostos no livro **Estatística e Ciência de Dados**, de autoria de Pedro Alberto Morettin e Júlio da Motta Singer, publicado pela LTC em 2022 [@MorettinSinger2022].

```{r fig.align='center', echo=FALSE, include=identical(knitr:::pandoc_to(), 'html'), out.width='250px'}
knitr::include_graphics('images/cover.png', dpi = NA)
```

É importante destacar que trata-se de um produto não oficial, as anotações e soluções de exercícios aqui apresentadas são de cunho pessoal e não possuem qualquer revisão ou análise por parte dos autores da obra ou da editora. Dessa forma e por se tratar de um produto construído durante o processo de aprendizagem, o conteúdo pode conter erros, tanto no texto em si, como na lógica utilizada para solução dos exercícios.

Dúvidas ou sugestões de melhoria podem ser encaminhadas para o e-mail *jeidsan.pereira@gmail.com*.

## Notas sobre a edição {-}

- As notas constantes neste material são, em sua maioria, citações oriundas do livro em questão ou de livros e artigos relacionados. As citações indiretas são escritas em texto padrão, sem nenhum destaque, e são seguidas pela referência ao material consultado. Já as citações diretas, são destacadas no texto conforme a o exemplo abaixo.

> Dado um número $0 < \alpha < 1$, a **média aparada** de ordem $\alpha$, $\overline{x}(\alpha)$, é definida como a média do conjunto de dados obtido após a eliminação das 100% primeiras observações ordenadas e das 100% últimas observações ordenadas do conjunto original [...]. Para $\alpha = 0,25$ obtemos a chamada **meia média**. [@MorettinSinger2022, p. 47]. 

- Para esta edição, a numeração dos exercícios foi levemente alterada para fazer menção ao número do capitulo. Desta forma o exercício aqui numerado como Exercício 3.12, corresponde ao exercício de número 12 do capítulo de número 3. Também adicionamos a extensão `.xls` ou `.doc` aos conjuntos de dados disponibilizados pelo autor, facilitando a busca pelos arquivos no diretório de dados.
- Para facilitar a navegação, quando possível, adicionamos links para outras partes do texto que estejam relacionadas.
- Sempre que possível, procuramos também adicionar as referências originais aos conjuntos de dados, com o intuito de facilitar a consulta pelo leitor. Por exemplo, o conjunto de dados `rehabcardio.xls` é oriundo da pesquisa realizada por @CarvalhoEtAl2007.

## Funções auxiliares {-}

Durante a solução dos exercícios, repetiremos muitas vezes algumas ações (como o carregamento de um arquivo, o cálculo de medidas de resumo para uma determinada variável, etc). Para evitar replicar o código para essas ações, vaos criar aqui algumas funções.

A primeira delas visa carregar um arquivo de dados:

```{r}
statds_read <- function(file, type = "csv", ...) {
  file <- paste0(data_dir, file)
  
  switch(
    type,
    "csv" = readr::read_csv(file, ...),
    "xls" = readxl::read_xls(file, ...)
  )
}
```

A segunda função tem o objetivo de gravar os dados ajustados em um arquivo:

```{r}
statds_write <- function(data, file, ...) {
  file <- paste0(data_dir, file)
  readr::write_csv(data, file, ...)
}
```


A nossa proxima função servirá para calcular um resumo de uma coluna de um data frame:

```{r}
statds_summarise <- function(data, x, ...) {
  x <- enquo(x)
  data %>% 
    group_by(...) %>%
    summarize(
        `n` = n(),
        `Média` = mean(!!x, na.rm = TRUE), 
        `Variância` = var(!!x, na.rm = TRUE),
        `Desvio Padrão` = sd(!!x, na.rm = TRUE),
        `Min.` = min(!!x),
        `Q1` = quantile(!!x, c(0.25), na.rm = TRUE)[[1]],
        `Mediana` = median(!!x, na.rm = TRUE),
        `Q3` = quantile(!!x, c(0.75), na.rm = TRUE)[[1]],
        `Máx.` = max(!!x),
        `IQR` = IQR(!!x, na.rm = TRUE)
    )
}

```

A próxima função tem o objetivo de construir a tabela de contingência para duas variáveis categóricas:

```{r}
statds_crosstable <- function(data, x, y, totals = TRUE) {
  x <- enquo(x)
  y <- enquo(y)
  
  data %>%
    group_by(!!x, !!y) %>%
    count() %>%
    bind_rows(
      group_by(., !!x) %>%
        summarise(n = sum(n)) %>%
        mutate(regiao = 'Total')
    ) %>%
    bind_rows(
      group_by(., !!y) %>%
        summarise(n = sum(n)) %>%
        mutate(estado = 'Total')
    ) %>%
    spread(!!y, n)
}
```

A função a seguir calcula o coeficiente de determinação (ou o ganho de varância) para uma variável quantitativa em relação a outra qualitativa.

```{r}
statds_rsquared <- function(data, x, y) {
  x <- enquo(x)
  y <- enquo(y)
  
  total <- data %>%
              select(!!x)
  
  var_total <- var(total)[[1]]
  
  groups <- data %>%
              group_by(!!y) %>%
              summarise(
                var = var(!!x, na.rm = TRUE)
              )
  
  var_groups <- mean(groups$var)
  
  1 - (var_groups / var_total)
}
```


## Pendências {-}

- Ajustar títulos do gráfico colocando a parte "Figura x.y:" em negrito;
- Ajustar capítulos 2 e 3 pra usarem as funções `statds_()` definidas acima;
- Melhorar os totais da função `statds_crosstable()` e utilizá-la nos exercícios;
- [Exercício 2.2](#exr2-2);
- Revisar estrutura do [Exercício 3.5](#exr3-5);
- Complementar a análise do [Exercício 3.12](#exr3-12);
- Reavaliar [Exercício 3.17](#exr3-17) - Questão mal formulada;
- Reavaliar [Exercício 3.18](#exr3-18) - Alternativas não parecem conter a resposta correta;
- Reavaliar [Exercício 3.27](#exr3-27);
- [Exercício 3.29](#exr3-29);
- [Exercício 3.31](#exr3-31);
- [Exercício 3.32](#exr3-32);
- [Exercício 3.33](#exr3-33);
- Validar cálculo de $R^2$ no [Exercício 4.1](#exr4-1);
- Revisar cálculo de conceito de $R^2$ no último item do [Exercício](#exr4-1);
-