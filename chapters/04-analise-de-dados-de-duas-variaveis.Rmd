# Análise de dados de duas variáveis

## Introdução

> De maneira geral, dizemos que existe uma associação entre duas variáveis se o conhecimento do valor de uma delas nos dá alguma característica da distribuição (de frequência) da outra. [@MorettinSinger2022, p. 79]

## Duas variáveis qualitativas

> Dnotando os valores observados por $o_i$ e os esperados por $e_i$, $i = 1, 2, 3, 4$, podemos calcular os *residuos* $r_i = o_i - e_i$ e verificar que $\sum_i r_i = 0$. Uma medida da discrepância entre os valores observados e aqueles esperados sob a hipótese $H$ é chamada estatística ou **qui-quadrado** de Pearson, $$\chi^2 = \sum\limits_{i = 1}^{n} \frac{(o_i - e_i)^2}{e_i}$$ [@MorettinSinger2022, p. 82].

> A própria estatística de Pearson poderia servir como medida da intensidade da associação mas seu valor valor aumenta com o tamanho da amostra; uma alternativa para corrigir ese problema é o **coeficiente de contingência de Pearson**, dado por $$C = \sqrt{\frac{\chi^2}{\chi^2 + n}}$$ [@MorettinSinger2022, p. 83].

> Uma modificação de $C$ é o ** ceficiente de Tschuprov**, $$ T = \sqrt{\frac{\chi^2/n}{\sqrt{(r - 1)(c - 1)}}} \ ,$$ que atinge o valor máximo igual a $1$ quando $r = c$ [@MorettinSinger2022, p. 83].

> Uma estimativa do índice denominado $\kappa$ de Cohen (1960), construido com esse propósito [avaliar a magnitude da concordância entre duas classificações] é $$\hat{\kappa} = \frac{\sum \limits_{i = 1}^{3}p_{ii} - \sum \limits_{i = 1}^{3}p_{i+}p_{+i}}{1 - \sum \limits_{i = 1}^{3}p_{i+}p_{+i}}$$ Nessa expressão, $p_{ij} representa frequência relativa associada à casela correspondente à linha $i$ e coluna $j$ da tabela [de contingência] e $p_{i+}$ e $p_{+j}$ representam a soma das frequências relativas asociadas à linha $i$ e coluna $j$, respectivamente [@MorettinSinger2022, p. 85].

> **Risco atribuível**: $d = \pi_1 - \pi_0$, que coresponde a diferença entre as probabilidades (ou riscos) de ocorrência do evento de interese para expostos e não expostos ao fator de risco [@MorettinSinger2022, p. 86].

> **Risco relativo**: $r=\pi_{1}/\pi_{0}$, que corresponde ao quociente entre as probabilidades de ocorrência do evento de interesse para expostos e não expostos ao fator de risco [@MorettinSinger2022, p. 87]. 

> **Razão de chances** (*odds ratio*): $\omega=[\pi_{1}/(1-\pi_{1})]/[\pi_{0}/(1-\pi_{0})]$, que corresponde ao quociente entre as chances de ocorrência do evento de interesse para expostos e não expostos ao fator de risco [@MorettinSinger2022, p. 87]. 

> **Acurácia**: corresponde à probabilidade de resultados corretos [@MorettinSinger2022, p. 89]. 

> Sensibilidade e especificidade são características do teste, mas tanto o valor preditivo positivo quanto o valor preditivo negativo dependem da **prevalência** (porcentagem de indivíduos doentes na população) da doença [@MorettinSinger2022, p. 89].

## Duas variáveis quantitativas

> Dado um conjunto de $n$ pares $(x_i, y_i)$, a associação (linear) entre as variáveis quantitativas $X$ e $Y$ pode ser quantificada por meio do **coeficiente de correlação (linear)** de Pearson, definifo por $$r_p = \frac{\sum \limits_{i=1}^{n}(x_i - \overline{x})(y_i - \overline{y})}{\left[ \sum \limits_{i = 1}^{n}(x_i - \overline{x})^2 \cdot \sum\limits_{i=1}^{n}(y_i - \overline{y})^2  \right]^{1/2}}$$ [@MorettinSinger2022, p. 91].

> [...] uma medida de associação mais robusta é o coeficiente de correlação de Apearman cuja expressão é similar à (4.4) [coef. de Pearson] com valores de $X$ e $Y$ substituídos pelos respectivos **postos**. [...] $$r_p = \frac{\sum \limits_{i=1}^{n}(R_i - \overline{R})(S_i - \overline{S})}{\left[ \sum \limits_{i = 1}^{n}(R_i - \overline{R})^2 \cdot \sum\limits_{i=1}^{n}(S_i - \overline{S})^2  \right]^{1/2}}$$ [@MorettinSinger2022, p. 92].

> [...] o coeficiente de correlação de Spearman é mais apropriado para avaliação de associações não lineares, desde que sejam **monotônicas** [...] [@MorettinSinger2022, p. 93].

> [...] dados longitudinais, *i.e.*, aqueles qem que a mesma variável é observada em cada unidade amostral mais do que uma vez ao longo do tempo [...] [@MorettinSinger2022, p. 95].

Gráfico de médias/diferenças ou gráfico de Bland-Altman "consiste num gráfico das diferenças entre duas observações pareadas $(X_{2i} -  X_{1i})$ em função das médias correspondentes $[(X_{1i} + X_{2i})/2]$, $i = 1, \cdots, n$" [@MorettinSinger2022, p. 97-98].

## Uma variável qualitativa e outra quantitativa

> Outro gráfico útil para avaliar a associação entre a variável quantitativa [...] e a variável qualitativa [...] é o **gráfico de perfis médios**. Nesse gráfico cartesiano as médias (e barras representando desvios padrões, erros padrões ou intervalos de confiança [...]) da variável quantitativa são representadas no eixo das ordenadas e os níveis da variável qualitativa, no eixo das abscissas [@MorettinSinger2022, p. 101].

> Então podemos definir o grau de associação entre duas variáveis como o ganho relativo na variância obtido pela introdução da variável qualitativa. Explicitamente: $$R^2 = \frac{Var(S) - \overline{Var(S)}}{Var(S)} = 1 - \frac{\overline{Var(S)}}{Var(S)}$$ Além disso, pode-se mostrar que $0 \le R^2 \le 1$ [@MorettinSinger2022, p. 106].

$R^2$ indica o percentual da variação de uma variável dependente que pode ser explicada pela variável independente [@MorettinSinger2022, p. 106].

## Notas de capítulo

> Embora não se possa calcular o risco relativo de doença em estudos retrospectivos, a razão de chances obtida por meio desse tipo de estudo é igual àquela que seria obtida por intermédio de um estudo prospectivo, que em muitas situações práticas não pode ser realizado devido ao custo [@MorettinSinger2022, p. 107].

## Exercícios

### Exercício 4.1 {- #exr4-1}

::: {.enunciado}
Considere o conjunto de dados disponível no arquivo `empresa.xls`. Compare as distribuições de frequências das variáveis `Estado civil`, `Grau de Instrução` e `Salário` para indivíduos com diferentes procedências. 
:::

:::{.solution}
Vamos começar carregando os dados.

```{r}
empresa <- readxl::read_xls(paste0(data_dir, "empresa.xls"), skip = 1)
colnames(empresa) <- c("id", "estado", "instrucao", "filhos", "salario", "anos", "meses", "regiao")

empresa <- empresa %>%
              mutate(
                estado = parse_factor(estado, levels = c("solteiro", "casado", "divorciado", "viúdo"), ordered = FALSE),
                instrucao = parse_factor(instrucao, ordered = TRUE, levels = c("ensino fundamental", "ensino médio", "superior")),
                regiao = parse_factor(regiao, ordered = FALSE, levels = c("interior", "capital", "outra")),
                idade = anos + (meses / 12)
              )

write_csv(empresa, paste0(data_dir, "empresa.csv"))
```

Com os dados carregados e arrumados, podemos partir para as análises.

#### Estado Civil *versus* Região de Procedência {-}

Por se tratar de duas variáveis categóricas, vamos analisá-las a partir da tabela de contingência, à estatística qui-quadrado de Pearson e ao coeficiente de contingência de Pearson.

```{r}
empresa %>%
  group_by(estado, regiao) %>%
  count() %>%
  bind_rows(
    group_by(., estado) %>%
      summarise(n = sum(n)) %>%
      mutate(regiao = "Total")
  ) %>%
  bind_rows(
    group_by(., regiao) %>%
      summarise(n = sum(n)) %>%
      mutate(estado = "Total")
  ) %>%
  spread(regiao, n) %>%
  kable(
    format = "pipe",
    caption = "**Tabela 4.1:** Distribuição conjunta das variáveis Estado Civil e Região de Procedência",
    label = NA,
    digits = 2,
    align = "c",
    format.args = list(decimal.mark = ",")
  )
  
```

Utilizaremos a função `chisq.test()` para calcular nossas estatísticas de interesse:

```{r}
qui_quadrado <- chisq.test(empresa$estado, empresa$regiao)$statistic[[1]]
n <- nrow(empresa)
c <- sqrt(qui_quadrado / (qui_quadrado + n))
```

Após os cálculos, constatamos que o valor de $\chi^2$ é `r qui_quadrado` e o coeficiente $C$ de contingência de Pearson é de `r c`, indicando uma baixa correlação entre as variáveis. 

#### Grau de Instrução *versus* Região de Procedência {-}

Novamente usaremos a tabela de contingência, a estatística qui-quadrado de Pearson e o coeficiente de contingência de Pearson.

```{r}
empresa %>%
  group_by(instrucao, regiao) %>%
  count() %>%
  bind_rows(
    group_by(., instrucao) %>%
      summarise(n = sum(n)) %>%
      mutate(regiao = "Total")
  ) %>%
  bind_rows(
    group_by(., regiao) %>%
      summarise(n = sum(n)) %>%
      mutate(instrucao = "Total")
  ) %>%
  spread(regiao, n) %>%
  kable(
    format = "pipe",
    caption = "**Tabela 4.2:** Distribuição conjunta das variáveis Grau de Instrução e Região de Procedência",
    label = NA,
    digits = 2,
    align = "c",
    format.args = list(decimal.mark = ",")
  )
  
```

Utilizaremos a função `chisq.test()` para calcular nossas estatísticas de interesse:

```{r}
qui_quadrado <- chisq.test(empresa$instrucao, empresa$regiao)$statistic[[1]]
n <- nrow(empresa)
c <- sqrt(qui_quadrado / (qui_quadrado + n))
```

Após os cálculos, constatamos que o valor de $\chi^2$ é `r qui_quadrado` e o coeficiente $C$ de contingência de Pearson é de `r c`, indicando uma baixa correlação entre as variáveis. 

#### Salário *versus* Região de Procedência {-}

Agora temos em mãos uma variável qualitativa e outra quantitativa. Utilizaremos uma tabela de resumo e gráfico de *boxplots* para avaliar a relação, além de calcularmos a estatística $R^2$.

A Tabela 4.3 a seguir apresenta as medidas de resumo para o salário dos funcionários, conforme a região de procedência do funcionário. A Figura 4.1 apresenta uma comparação gráfica dos salários utilizando *boxplots*.

```{r}
empresa %>%
  statds_summarise(salario, regiao) %>%
  kable(
    format = "pipe",
    caption = "**Tabela 4.3:** Medidas de resumo para a variável `Salário`, conforme `Região de procedência`",
    label = NA,
    digits = 2,
    align = "c",
    format.args = list(decimal.mark = ",")
  )
```

```{r}
empresa %>%
  ggplot(aes(regiao, salario)) +
    stat_boxplot(
      geom = "errorbar", 
      width = 0.2
    ) +
    geom_boxplot(
      fill = "grey", 
      color = "grey30"
    ) +
    labs(
      title = bquote(bold("Figura 4.1:")~"Distribuição dos salários conforme região de procedência"),
      x = "Região de Procedência",
      y = "Salário"
    ) +
    tema
  
```

Utilizamos a função `var()` da base do R para calcular a variância total da variável salário $Var(salário) = 21.04477$ e os dados da Tabela 4.1 para calcular a média de variação da variável por grupos $\overline{Var(salário)} = 22.08694$ e chegamos a $R^2 = -0.0495217$. Como os valores estão inconsistentes, será necessário revisar este item.

:::

### Exercício 4.2 {- #exr4-2}

::: {.enunciado}
Considere o conjunto de dados disponível no arquivo `regioes.xls`. Avalie a relação entre variáveis `Região` e `Densidade populacional`.
:::

:::{.solution}
Como de costume, iniciaremos o exercício com o carregamento e ajuste dos dados.

```{r}
regioes <- statds_read("regioes.xls", "xls")
colnames(regioes) <- c("regiao", "estado", "superficie", "populacao", "densidade")

regioes <- regioes %>%
              filter(estado != "Subtot") %>%
              filter(estado != "Total") %>%
              fill(regiao) %>%
              mutate(
                regiao = parse_factor(regiao),
                estado = parse_factor(estado)
              )

statds_write(regioes, "regioes.csv")
```


Como temos uma variável qualitativa e outra quantitativa, vamos exibir uma tabela de resumos, um gráfico de *boxplots* e calcular o coeficiente de determinação $R^2$.

```{r}
regioes %>%
  statds_summarise(densidade, regiao) %>%
  kable(
    format = "pipe",
    caption = "**Tabela 4.4:** Medidas de resumo para a variável `Densidade Populacional`, conforme `Região`",
    label = NA,
    digits = 2,
    align = "c",
    format.args = list(decimal.mark = ",")
  )
```

```{r}
regioes %>%
  ggplot(aes(regiao, densidade)) +
    stat_boxplot(
      geom = "errorbar", 
      width = 0.2
    ) +
    geom_boxplot(
      fill = "grey", 
      color = "grey30"
    ) +
    labs(
      title = bquote(bold("Figura 4.2:")~"Densidade populacional conforme região"),
      x = "Região",
      y = "Densidade populacional"
    ) +
    tema
```

Pendente calcular o $R^2$ e interpretar os resultados.

:::

### Exercício 4.3 {- #exr4-3}

::: {.enunciado}
Considere o conjunto de dados disponível no arquivo `salarios.xls`.

a. Compare as distribuições das variáveis `Salário de professor secundário` e `Salário de administrador` por de um gráfico QQ e interprete os resultados.
b. Calcule o coeficiente de correlação de Pearson e o coeficiente de correlação robusto (4.15) com $\alpha = 0,10$ entre essas duas variáveis.
:::

:::{.solution}
Carregando os dados:

```{r}
salarios <- statds_read("salarios.xls", "xls", skip = 4)
colnames(salarios) <- c("cidade", "prof_sec", "mecanico","administrador","eng_eletr")
```

#### Comparando os salários a partir de um gráfico QQ {-}

Como a função `geom_qq()` trabalha apenas com uma variável (comparando os seus quantis com os quantis teóricos), precisaremos construir o gráfico manualmente.

```{r}
quantiles <- seq(0, 1, 0.1)
quantiles_prof_sec <- quantile(salarios$prof_sec, quantiles)
quantiles_administrador <- quantile(salarios$administrador, quantiles)

ggplot(
  mapping = aes(
              x = quantiles_prof_sec, 
              y = quantiles_administrador,
              slope = 1, 
              intercept = 0
            )
) +
  geom_point() +
  geom_abline(linetype = 2) +
  labs(
    title = bquote(bold("Figura 4.3:")~"Quantis entre o salário de professores secundaristas e administradores"),
    x = "Prof. Sec.",
    y = "Administrador"
  ) +
  tema +
  coord_cartesian(xlim = c(0,80000), ylim = c(0,80000))
```

O gráfico sugere que os salários de administradores são bastante superiores aos salários dos professores secundaristas.

:::

### Exercício 4.4 {- #exr4-4}

::: {.enunciado}
Para os dados do arquivo `salarios.xls`, considere a variável `Região`, com as classes `América do Norte`, `América Latina`, `Europa` e `Outros` e a variável `Salário de professor secundário`. Avalie a associação entre essas duas variáveis. 
:::

:::{.solution}
Iniciamos com a carga dos dados:

```{r}
salarios <- statds_read("salarios.xls", "xls", skip = 3)
```

Agora vamos adicionar uma nova variável contendo a região. Começamos criando um vetor com os fatores que utilizaremos.

```{r}
continente <- c("América do Norte", "América Latina", "Europa", "Outros")

regioes <- c("Europa", "Europa", "América Latina", "Europa", "América Latina", "América Latina", "América do Norte", "América Latina", "Europa", "Europa", "Europa", "Outros", "Outros", "Europa", "América do Norte", "Europa", "Outros", "Europa", "América do Norte", "América do Norte", "Europa", "América Latina", "América do Norte", "América Latina", "Outros", "Outros", "Outros", "Outros", "América do Norte", "Europa")

salarios$`Região` <- parse_factor(regioes, levels = continente)
```

Como trata-se de uma variável contínua e outra categorica, vamos construir uma tabela resumindo os salários por continente e também exibir um diagrama de *boxplots*.

```{r}
salarios %>%
  statds_summarise(`Prof. Sec.`, `Região`) %>%
  kable(
    format = "pipe",
    caption = "**Tabela 4.5:** Medidas de resumo para a variável `Salário de Professor Secundarista` conforme `Região`",
    label = NA,
    digits = 2,
    align = "c",
    format.args = list(decimal.mark = ",")
  )
```

```{r}
salarios %>%
  ggplot(aes(`Região`, `Prof. Sec.`)) +
    stat_boxplot(
      geom = "errorbar",
      width = 0.2
    ) +
    geom_boxplot(
      fill = "grey", 
      color = "grey30"
    ) +
  labs(
    title = bquote(bold("Figura 4.4:")~"Salário de professor secundarista por região"),
    y = "Salário",
    x = "Região"
  ) +
  tema
  
```

O cálculo de $R^2$ é dado por 

```{r}
r2 <- statds_rsquared(salarios, `Prof. Sec.`, `Região`)
```

Concluímos que o ganho de variância dado pela adição da variável `Região` é `r r2`, ou seja, aproximadamente `r round(r2 * 100, digits = 2)`% da variação dos salários dos professores secundaristas é explicada pela região.

:::

### Exercício 4.5 {- #exr4-5}

::: {.enunciado}
Analise a variável `Preço de veículos` segundo as categorias `N` (nacional) e `I` (importado) para o conjunto de dados disponível no arquivo `veiculos.xls`.
:::

:::{.solution}
Iniciaremos carregando os dados:

```{r}
veiculos <- statds_read("veiculos.xls", "xls")
```

Novamente, utilizaremos uma tabela resumo, um gráfico de *boxplots* e o ganho de variância para avaliar visualmente a relação entre as variáveis.

```{r}
veiculos %>%
  statds_summarise(preco, proc) %>%
  kable(
    format = "pipe",
    caption = "**Tabela 4.6:** Medidas de resumo para a variável `Preço do veículo` conforme a `Procedência`",
    label = NA,
    digits = 2,
    align = "c",
    format.args = list(decimal.mark = ",")
  )
```


```{r}
veiculos %>%
  ggplot(aes(proc, preco)) +
    stat_boxplot(
      geom = "errorbar",
      width = 0.2
    ) +
    geom_boxplot(
      fill = "grey", 
      color = "grey30"
    ) +
  labs(
    title = bquote(bold("Figura 4.5:")~"Preço dos veículos conforme a procedência"),
    y = "Preço",
    x = "Procedência"
  ) +
  tema
```

Apesar de termos uma diferença nos preços, não podemos afirmar que há uma relação entre as variáveis. O coeficiente de determinação $R^{2}$ é `r statds_rsquared(veiculos, preco, proc)`, indicando que apenas aproximadamente 9% da variação de preço pode ser explicada pela procedência do veículo.

:::

### Exercício 4.6 {- #exr4-6}

::: {.enunciado}
Considere o conjunto de dados disponível no arquivo `coronarias.xls` [@SingerIkeda1996].

a. Construa gráficos QQ para comparar a distribuição da variável `COL` de pacientes masculinos (= 1) com aquela de femininos (= 0). Repita a análise para a variável `IMC` e discuta os resultados. 
b. Calcule o coeficiente de correlação de Pearson e o coeficiente de correlação de Spearman entre as variáveis `ALTURA` e `PESO`.
c) Construa uma tabela de contingência para avaliar a distribuição conjunta das variáveis TABAG4 e ARTER e calcule a intensidade de associação entre elas utilizando a estatística de Pearson, o coeficiente de contingencia de Pearson e o coeficiente de Tschuprov. 
:::

:::{.solution}
Iniciaremos carregando os dados.

```{r}
coronarias <- statds_read("coronarias.xls", "xls", sheet = "dados")
coronarias <- coronarias %>% 
                mutate(
                  IMC = parse_double(IMC),
                  PESO = parse_double(PESO),
                  ALTURA = parse_double(ALTURA),
                  ARTER = as.factor(ARTER),
                  TABAG4 = as.factor(TABAG4)
                )

print(head(coronarias))
```


#### Colesterol de pacientes conforme o sexo {-}

A figura a seguir mostra o gráfico QQ comparando os níveis de colesterol entre homens e mulheres.

```{r}
quantiles <- seq(0, 1, 0.01)
homens <- coronarias %>% filter(SEXO == 1)
mulheres <- coronarias %>% filter(SEXO == 0)

q_col_homens <- quantile(homens$COL, quantiles, na.rm = TRUE)
q_col_mulheres <- quantile(mulheres$COL, quantiles, na.rm = TRUE)

ggplot(
  mapping = aes(
              x = q_col_homens, 
              y = q_col_mulheres,
              slope = 1, 
              intercept = 0
            )
) +
  geom_point() +
  geom_abline(linetype = 2) +
  labs(
    title = bquote(bold("Figura 4.6:")~"Quantis dos níveis de colesterol entre homens e mulheres"),
    x = "Homens",
    y = "Mulheres"
  ) +
  tema +
  coord_cartesian(xlim = c(50,620), ylim = c(50,450))
```

Como os pontos estão muito próximos da reta $y = x$, o gráfico sugere que há pouca diferença entre os níveis de colesterol dos dois grupos. O mesmo comportamento pode ser visto no gráfico de médias e diferenças a seguir.

#### IMc de pacientes conforme o sexo {-}

A figura a seguir mostra o gráfico QQ comparando o IMC entre homens e mulheres.

```{r}
q_imc_homens <- quantile(homens$IMC, quantiles, na.rm = TRUE)
q_imc_mulheres <- quantile(mulheres$IMC, quantiles, na.rm = TRUE)

ggplot(
  mapping = aes(
              x = q_imc_homens, 
              y = q_imc_mulheres,
              slope = 1, 
              intercept = 0
            )
) +
  geom_point() +
  geom_abline(linetype = 2) +
  labs(
    title = bquote(bold("Figura 4.7:")~"Quantis das medidas de IMC entre homens e mulheres"),
    x = "Homens",
    y = "Mulheres"
  ) +
  tema 
```

O gráfico sugere que temos pouca diferença entre o IMC de homens de o de mulheres.

#### Correlação entre altura e peso {-}

Para cálculo do coeficiente de correlação utilizaremos a função `cor()` do pacote base do R. 

A expressão `cor(coronarias$ALTURA, coronarias$PESO, method = "pearson", use = "complete.obs")` calcula o coeficiente de correlação de Pearson e nos resulta o valor `r cor(coronarias$ALTURA, coronarias$PESO, method = "pearson", use = "complete.obs")`.

A expressão `cor(coronarias$ALTURA, coronarias$PESO, method = "spearman", use = "complete.obs")` calcula o coeficiente de correlação de Spearman e nos resulta o valor `r cor(coronarias$ALTURA, coronarias$PESO, method = "spearman", use = "complete.obs")`.

#### Relação entre as variáveis `TABAG4` e `ARTER` {-}

```{r}
coronarias %>%
  filter(!is.na(TABAG4)) %>%
  filter(!is.na(ARTER)) %>%
  group_by(TABAG4, ARTER) %>%
  count() %>%
  bind_rows(
    group_by(., TABAG4) %>%
      summarise(n = sum(n)) %>%
      mutate(ARTER = "Total")
  ) %>%
  bind_rows(
    group_by(., ARTER) %>%
      summarise(n = sum(n)) %>%
      mutate(TABAG4 = "Total")
  ) %>%
  pivot_wider(
    names_from = ARTER,
    values_from = n,
    values_fill = 0
  ) %>%
  kable(
    format = "pipe",
    caption = "**Tabela 4.7:** Frequência de artereopatia entre quatro categorias de tabagismo",
    label = NA,
    digits = 2,
    align = "c",
    format.args = list(decimal.mark = ",")
  )
```

O trecho de código a seguir calcula as nossas estatísticas de interesse.

```{r}
chisq <- chisq.test(coronarias$TABAG4, coronarias$ARTER)
chisq <- chisq$statistic[[1]]

n <- nrow(coronarias)
r <- 6
c <- 4

C <- sqrt(chisq / (chisq + n))
t <- sqrt((chisq / n) / ((r-1) * (c-1)))
```

A estatística de Pearson é `r chisq`, o coeficiente de contingência de Pearson é `r C` e o coeficiente de Tschuprov é `r t`. Todas essas estatísticas nos sugerem que a associação entre as variáveis é muito fraca ou inexistente.

:::

### Exercício 4.7 {- #exr4-7}

::: {.enunciado}
Considere os dados do arquivo `endometriose.xls` [@AbraoEtAl1997]. Construa um gráfico QQ para comparar as distribuições da variável `Idade` de pacientes dos grupos `Controle` e `Doente`.
:::

:::{.solution}
No [Exercício 3.12](#exr3-12), já havíamos tratado os dados deste conjunto. Vamos carregar o arquivo final que geramos, que já contem os dados ajustados.

```{r}
endometriose <- statds_read("endometriose.csv")
```
Com os dados carregados, vamos contruir o gráfico QQ:

```{r}
controle <- (endometriose %>% filter(Grupo == "Controle"))$Idade
doente <- (endometriose %>% filter(Grupo == "Doente"))$Idade

quantiles <- seq(0, 1, 1/15)
q_controle <- quantile(controle, quantiles)
q_doente <- quantile(doente, quantiles)

ggplot() +
  geom_point(aes(q_controle, q_doente)) +
  geom_abline(aes(slope = 1,intercept = 0), linetype = 2) +
  labs(
    title = bquote(bold("Figura 4.8:")~"Quantis das idades dos pacientes dos grupos Caso e Controle"),
    x = "Controle",
    y = "Casos"
  ) +
  tema +
  coord_cartesian(
    xlim = c(20,45),
    ylim = c(20,45)
  )
```


```{r}
q_media <- (q_controle + q_doente) / 2
q_diferenca <- q_controle - q_doente

ggplot() +
  geom_point(aes(q_media, q_diferenca)) +
  geom_hline(yintercept = 0, linetype = 2) +
  labs(
    title = bquote(bold("Figura 4.9:")~"Médias"~italic("versus")~"diferenças entre os quantis das idades das pacientes"),
    x = "Médias",
    y = "Diferenças"
  ) +
  tema
```

O gráfico da Figura 4.8 nos mostra que existe uma diferença entre as idades das pacientes, sendo as do grupo controle mais jovens do que as do grupo de casos. A Figura 4.9, por sua vez, nos dá uma visão mais clara da magnitude dessa diferença (diferença média de `r mean(q_diferenca)` anos e desvio padrão de `r sd(q_diferenca)` anos).

:::

### Exercício 4.8 {- #exr4-8}

::: {.enunciado}
Considere os dados do arquivo `neonatos.xls` contendo pesos de recém nascidos medidos por via ultrassonográfica (antes do parto) e ao nascer. Construa gráficos QQ e gráficos Bland-Altman para avaliar a concordância entre as duas distribuições. Comente os resultados.
:::

:::{.solution}
#### Carregamento dos dados {-}

```{r}
neonatos <- statds_read("neonatos.xls", "xls")
```

#### Gráfico QQ {-}

```{r}
quantiles <- seq(0, 1, 1/68)
q_peso1 <- quantile(neonatos$peso1, quantiles)
q_peso2 <- quantile(neonatos$peso2, quantiles)

ggplot() +
  geom_point(aes(q_peso1, q_peso2)) +
  geom_abline(aes(slope = 1, intercept = 0), linetype = 2) +
  labs(
    title = bquote(bold("Figura 4.10:")~"Quantis dos pesos de recém nascidos"),
    x = "Peso obtido ultrassonograficamente (g)",
    y = "Peso ao nascer (g)"
  ) +
  tema
```

#### Gráfico Bland-Altman {-}

```{r}
q_media <- (neonatos$peso2 + neonatos$peso1) / 2
q_diferenca <- (neonatos$peso2 - neonatos$peso1)

ggplot() +
  geom_point(aes(q_media, q_diferenca)) +
  geom_hline(yintercept = 0, linetype = 2) +
  labs(
    title = bquote(bold("Figura 4.11:")~"Diferença entre as medidas do peso dos recém nascidos"),
    x = "Média das medidas (g)",
    y = "Diferença entre as medidas (g)"
  ) +
  tema
```

#### Comentários {-}

A Figura 4.10 nos mostra que a medida do peso obtida por via ultrassonográfica é levemente menor do que aquela obtida ao nascer. A Figura 4.11 nos dá uma melhor visão dessa diferença (média: `r mean(q_diferenca)`g, desvio padrão: `r sd(q_diferenca)`g, mediana: `r median(q_diferenca)`g). A média das diferenças corresponde a um percentual de `r round((mean(q_diferenca) / mean(neonatos$peso2)) * 100, digits = 2)` em relação ao peso real aferido ao nascer.

:::

### Exercício 4.9 {- #exr4-9}

::: {.enunciado}
Considere o conjunto de dados disponível no arquivo `esforco.xls`.

a. Compare as distribuições de frequências da variável `V02` em repouso e no pico do exercício para pacientes classificados em cada um dos níveis da variável `Etiologia` por meio de gráficos QQ e de medidas resumo. Comente os resultados. 
b. Repita o item (a) utilizando gráficos de Bland-Altman.
c. Utilize *boxplots* e gráficos de perfis médios para comparar as distribuições da variável `FC` correspondentes a pacientes nos diferentes níveis da variável `NYHA`. Comente os resultados.
:::

:::{.solution}
x
:::

### Exercício 4.10 {- #exr4-10}

::: {.enunciado}
Os dados da Tabela 4.29 são provenientes de um estudo em que um dos objetivos era avaliar o efeito da dose de radiação gama (em centigrays) na formação de múltiplos micronúcleos em células de individuos normais. Analise os dados descritivamente, calculando o risco relativo de ocorrência de micronúcleos para cada dose tomando como base a dose nula. Repita a análise calculando as razões de chances correspondentes. Quais as conclusões de suas análises?

| Dose de radiação <br />gama (cGy) | Frequência de células <br /> com múltiplos micronúcleos | Total de células <br />examinadas |
|:---------------------------------:|:-------------------------------------------------------:|:---------------------------------:|
| 0                                 | 1                                                       | 2373                              |
| 20                                | 6                                                       | 2662                              |
| 50                                | 25                                                      | 1991                              |
| 100                               | 47                                                      | 2047                              |
| 200                               | 82                                                      | 2611                              |
| 300                               | 207                                                     | 2442                              |
| 400                               | 254                                                     | 2398                              |
| 500                               | 285                                                     | 1746                              |
: **Tabela 4.29:** Número de células
:::

:::{.solution}
x
:::

### Exercício 4.11 {- #exr4-11}

::: {.enunciado}
Numa cidade A em que não foi veiculada propaganda, a porcentagem de clientes que desistem do plano de TV a cabo depois de um ano é 14%. Numa cidade B, em que houve uma campanha publicitária, essa porcentagem é de 6%. Considerando uma aproximação de 2 casas decimais, indique qual é a razão de chances (re) de desistência entre as cidades A e B, justificando sua resposta:

a) $re = 2.33$
b) $re = 2.55$
c) $re = 8.00$
d) $re = 1.75$ 
e) Nenhuma das respostas anteriores está correta.
:::

:::{.solution}
x
:::

### Exercício 4.12 {- #exr4-12}

::: {.enunciado}
De uma tabela construída para avaliar a associação entre tratamento (com níveis ativo e placebo) e cura (sim ou não) de uma certa moléstia obteve-se uma razão de chances igual a 2,0. Mostre que não se pode concluir dai que a probabilidade de cura para pacientes submetidos ao tratamento ativo é 2 vezes a probabilidade de cura para pacientes submetidos ao placebo.
:::

:::{.solution}
x
:::

### Exercício 4.13 {- #exr4-13}

::: {.enunciado}
Considere os dados do arquivo `esquistossomose.xls`. Calcule a sensibilidade, especificidade, taxas de falsos positivos e falsos negativos, valores preditivos positivos e negativos e acurácia correspondentes aos cinco testes empregados para diagnóstico de esquistossomose.
:::

:::{.solution}
x
:::

### Exercício 4.14 {- #exr4-14}

::: {.enunciado}
Considere os dados do arquivo `entrevista.xls`. Calcule estatísticas $\kappa$ sem e com ponderação para quantificar a concordância entre as duas observadoras (G e P) para as variáveis `Impacto` e `Independência` e comente os resultados.

:::

:::{.solution}
x
:::

### Exercício 4.15 {- #exr4-15}

::: {.enunciado}
Considere os dados do arquivo `figadodiag.xls`. Calcule a sensibilidade, especificidade, taxas de falsos positivos e falsos negativos, valores preditivos positivos e negativos e acurácia das técnicas radiológicas para detecção de alterações anatômicas na veia porta e na via biliar tendo os resultados intraoperatórios como padrão ouro.
:::

:::{.solution}
x
:::

### Exercício 4.16 {- #exr4-16}

::: {.enunciado}
Um criminologista desejava estudar a relação entre: X (densidade populacional = número de pessoas por unidade de área) e Y (índice de assaltos = número de assaltos por 100000 pessoas) em grandes cidades. Para isto sorteou 10 cidades observando em cada uma delas os valores de X e Y. Os resultados obtidos estão dispostos na Tabela 4.30

| Cidade | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  |
|:------:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| X      | 59  | 49  | 75  | 65  | 89  | 70  | 54  | 78  | 56  | 60  |
| Y      | 190 | 180 | 198 | 186 | 200 | 204 | 192 | 215 | 197 | 208 |
: **Tabela 4.30:** Densidade populacional e índice de assaltos em grandes cidades

a. Classifique as variáveis envolvidas.
b. Calcule a média, mediana, desvio padrão e a distância interquartis para cada varikvel 
c. Construa o diagrama de dispersão entre Ye Xe faça comentários sobre a relação entre as duas variáveis.
:::

:::{.solution}
x
:::

### Exercício 4.17 {- #exr4-17}

::: {.enunciado}
Considere a seguinte tabela.

| X | 1 | 3 | 4 | 6 | 8 | 9 | 11 | 14 |
| Y | 1 | 2 | 4 | 4 | 5 | 7 | 8  | 9  |

Indique qual a afirmação abaixo sobre a relação entre as variáveis X e Y é correta, justificando sua resposta.

a) Não há associação entre X e Y.
b) Há relação linear positiva.
c) Hå relação linear negativa.
d) Há relação quadrática.
:::

:::{.solution}
x
:::

### Exercício 4.18 {- #exr4-18}

::: {.enunciado}
Em um teste de esforço cardiopulmonar aplicado a 55 mulheres e 104 homens, foram medida entre outras, as seguintes variáveis:

- Grupo: Normais, Cardiopatas ou DPOC (portadores de doença pulmonar obstrutiva crônica).
- VO2MAX: consumo máximo de $O_2$ (ml/min). 
- VCO2MAX: consumo máximo de $CO_2$ (ml/min).

Algumas medidas descritivas e gráficos são apresentados abaixo nas Tabelas 4.31 e 4.32 e Figura 4.21.

| Grupo        | n     | Média  | Mediana | Desvio Padrão | 
|:-------------|:-----:|:------:|:-------:|:-------------:|
| Normais      | 56    | 1845   | 1707    | 795           |
| Cardiopatas  | 57    | 1065   | 984     | 434           |
| DPOC         | 46    | 889    | 820	    | 381           |
: **Tabela 4.31:** VO2MAX

| Grupo        | n     | Média  | Mediana | Desvio Padrão | 
|:-------------|:-----:|:------:|:-------:|:-------------:|
| Normais      | 56    | 2020   | 1847    | 918           |
| Cardiopatas  | 57    | 1206   | 1081    | 479           |
| DPOC         | 46    | 934    | 860     | 430		  |
: **Tabela 4.32:** VCO2MAX

```{r fig.align='center', echo=FALSE, include=identical(knitr:::pandoc_to(), 'html'), out.width='450px'}
knitr::include_graphics('images/exr4-18.png', dpi = NA)
```

Coeficiente de correlação entre VO2MAX e VCO2MAX = 0,92.

a. Que grupo tem a maior variabilidade?
b. Compare as médias e as medianas dos 3 grupos.
c. Compare as distâncias interquartis dos 3 grupos para cada variável. Você acha rasi usar a distribuição normal para esse conjunto de dados?
d. O que representam os asteriscos nos boxplots?
e. Que tipo de função você ajustaria para modelar a relação entre o consumo máximo de $CO_2$ e o consumo máximo de $O_2$? Por quê?
f. Há informações que necessitam verificação quanto à possíveis erros? Quais?
:::

:::{.solution}
x
:::

### Exercício 4.19 {- #exr4-19}

::: {.enunciado}
Para avaliar a associação entre a persistência do canal arterial (PCA) em recém-nascidos pré-termo (RNPT) e óbito ou hemorragia intracraniana (HI), um pesquisador obteve os dados dispostos na seguinte tabela de frequências:

| PCA      | <br />Sim | Óbito <br />Não | <br /> Total | <br />Sim | HI <br />Não | <br />Total |
|:--------:|:---------:|:---------------:|:------------:|:---------:|:------------:|:-----------:|
| Presente | 8         | 13              | 21           | 7         | 14           | 21          |
| Ausente  | 1         | 39              | 40           | 7         | 33           | 40          |
| Total    | 9         | 52              | 61           | 14        | 44           | 61          |

Um resumo das análises para óbitos e hemorragia intracraniana está disposto na tabela seguinte:

```{r fig.align='center', echo=FALSE, include=identical(knitr:::pandoc_to(), 'html'), out.width='450px'}
knitr::include_graphics('images/exr4-19.png', dpi = NA)
```

a. Interprete as estimativas das razões de chances, indicando claramente a que pacientes elas se referem.
b. Analogamente, interprete os intervalos de confiança correspondentes, indicando claramente a que pacientes eles se referem.
c. Com base nos resultados anteriores, o que você pode concluir sobre a associação entre persistência do canal arterial e óbito para RNPT em geral? E sobre a associação entre a persistência do canal arterial e a ocorrência de hemorragia interna? Justifique suas respostas.
d. Qual a hipótese nula testada em cada caso?
e. Qual a interpretação dos valores-p em cada caso?

Detalhes podem ser obtidos em Afiune (2000).

:::

:::{.solution}
x
:::

### Exercício 4.20 {- #exr4-20}

::: {.enunciado}
Em um estudo realizado para avaliar o efeito do tabagismo nos padrões de sono foram consideradas amostras de tamanhos 12 e 15 de duas populações: Fumantes e Não Fumantes, respectivamente. A variável observada foi o tempo, em minutos, que se leva para dormir. Os correspondentes *boxplots* e gráficos de probabilidade normal são apresentados nas Figuras 4.22 e 4.23.

```{r fig.align='center', echo=FALSE, include=identical(knitr:::pandoc_to(), 'html'), out.width='450px'}
knitr::include_graphics('images/exr4-20-1.png', dpi = NA)
```

```{r fig.align='center', echo=FALSE, include=identical(knitr:::pandoc_to(), 'html'), out.width='450px'}
knitr::include_graphics('images/exr4-20-2.png', dpi = NA)
```

Esses gráficos sugerem que:

a. a variabilidade do tempo é a mesma nas duas populações estudadas; 
b. as suposições para a aplicação do teste t-Student para comparar as médias dos tempos nas duas populações estão válidas;
c. os fumantes tendem a apresentar um tempo maior para dormir do que os não fumantes;
d. as informações fornecidas permitem concluir que o estudo foi bem planejado; 
e. nenhuma das respostas anteriores está correta.

:::

:::{.solution}
x
:::

### Exercício 4.21 {- #exr4-21}

::: {.enunciado}
Em um estudo comparativo de duas drogas para hipertensão os resultados indicados nas Tabelas 4.33, 4.34 e 4.35 e Figura 4.24 foram usados para descrever a eficácia e a tolerabilidade das drogas ao longo de 5 meses de tratamento.

```{r fig.align='center', echo=FALSE, include=identical(knitr:::pandoc_to(), 'html'), out.width='450px'}
knitr::include_graphics('images/exr4-21.png', dpi = NA)
```

a. Com a finalidade de melhorar a apresentação dos resultados, faça as alterações que você julgar necessárias em cada uma das tabelas e figura.
b. Calcule a média, o desvio padrão e a mediana da variação de pressão arterial para cada uma das duas drogas por meio do histograma.
c. Compare os resultados obtidos no item b com aqueles obtidos diretamente dos dados da amostra (Tabela 4.35).
:::

:::{.solution}
x
:::

### Exercício 4.22 {- #exr4-22}

::: {.enunciado}
Considere duas amostras de uma variável X com n unidades amostrais cada. Utilize a definição (4.9) para mostrar que Var(X) = Var(X) quando as médias das duas amostras são iguais.
:::

:::{.solution}
x
:::

### Exercício 4.23 {- #exr4-23}

::: {.enunciado}
Utilize o método Delta para calcular uma estimativa da variancia da razão de chances (ver Nota de Capítulo 7).
:::

:::{.solution}
x
:::

### Exercício 4.24 {- #exr4-24}

::: {.enunciado}
Utilizando a definição da Nota de Capítulo 4, prove que se $\alpha = 0$, então $r(\alpha) = r$.
:::

:::{.solution}
x
:::

### Exercício 4.25 {- #exr4-25}

::: {.enunciado}
Mostre que para a hipótese de inexistência de associação numa tabela $r \times s$, a estatística (4.1) pode ser escrita como

$$\chi^{2}=\sum_{i=1}^{r}\sum_{j=1}^{s}\frac{(n_{ij}-n_{i+}n_{+j}/n)^{2}}{n_{i+}n_{+j}/n}$$

em que $n_{ij}$ é a frequência absoluta observada na linha $i$ e coluna $j$ e $n_{i+}$ e $n_{+j}$ são, respectivamente, os totais das linhas e colunas.
:::

:::{.solution}
x
:::

### Exercício 4.26 {- #exr4-26}

::: {.enunciado}
Prove que a expressão da estatística de Pearson do [Exercício 4.10](#exr4-10) pode ser escrita como

$$\chi^{2}=n\sum_{i=1}^{r}\sum_{j=1}^{s}\frac{(f_{ij}-f_{ij}^{*})^{2}}{f_{ij}^{*}}$$,

em que :$f_{ij}$ e $f^{*}_{ij}$ representam, respectivamente, as frequências relativas observada e esperada (sob a hipótese de inexistência de associação) correspondentes à casela $(i, j)$.
:::

:::{.solution}
x
:::

### Exercício 4.27 {- #exr4-27}

::: {.enunciado}
Prove que (4.4) e (4.5) são equivalentes.
:::

:::{.solution}
x
:::

### Exercício 4.28 {- #exr4-28}

::: {.enunciado}
 Prove as relações (4.12)-(4.14).
:::

:::{.solution}
x
:::